var validationRegex={notEmptyOrAllWhitespace:/^(?!s*$).+/,cardholderName:/^[A-Za-z]+[a-zA-Z0-9.\s\-']+$/,cardNumber:/^[0-9]{12,20}$/,issue:/^[0-9]{1,2}$/,csc:/^[0-9]{3}$/,amexCsc:/^[0-9]{4}$/,fullYear:/^[0-9]{4}?$/,shortYear:/^[0-9]{2}?$/};function enablePayNowSubmitButton(){if(disableSubmitButton){var a=true;if(isInlineValidationEnabled()){if($("input[name='paymentMethod']").is(":visible")&&!$("input[name='paymentMethod']").is(":checked")){a=false;}if(!$("input[name='paymentMethod']").is(":visible")||$("input[name='paymentMethod']:checked").val()=="CARD"){$.each($("div[class*='formSection']"),function(c,b){if($(b).is(":visible")&&$(b).hasClass("required")){$.each($(b).find("*[class*='formInput']"),function(e,d){if(!a){return;}if($(d).prop("nodeName").toUpperCase()=="SELECT"){if($(d).val()==""){a=false;}}if($(d).prop("nodeName").toUpperCase()=="INPUT"){if($(d).prop("type").toLowerCase()=="checkbox"&&(!$(d).prop("checked")||$(d).parent("div").hasClass("inputError"))){a=false;}if(!$(d).prop("disabled")&&($(d).prop("type").toLowerCase()=="text"||$(d).prop("type").toLowerCase()=="tel")&&($(d).val()==""||$(d).parent("div").hasClass("inputError")||$(d).closest("div").siblings(".formSection").hasClass("inputError"))){a=false;}}});}});}}else{if($("#cardholderNameSection").hasClass("inputError")||$("#confirmCardholderNameSection").hasClass("inputError")){a=false;}}payNowButtonStatus(a);}}function payNowButtonStatus(a){var c=document.getElementsByClassName("paynowButtonStatus")[0];var d=submitOrderButtonText+" "+(a?btnStatusEnabledText:btnStatusDisabledText);c&&(c.style.display=a?"none":"block");c&&c.setAttribute("aria-label",d);document.getElementById("btnSubmit").setAttribute("aria-label",d);var b=$("#btnSubmit");b.removeAttr("title");b.prop("disabled",!a);$("#paynowButtonHolder span").prop("tabIndex",a?-1:0);}function paymentMethodValidation(a){enablePayNowSubmitButton();if($("input[name='paymentMethod']:checked").val()==="CARD"){$(".formInput, .formInputForError")[0].focus();}}function checkboxValidation(a){if($(this).parents("div.required").length!==0){if(!$(this).prop("checked")){setFieldInvalid(this);}else{setFieldValid(this);}}switch($(this).prop("id")){case"confirmCheck1":if($("#confirmCheck1").hasClass("formInputForError")){$("#confirmCheck1MessagePanel").css("display","none");$("#confirmCheck1").removeClass("formInputForError").addClass("formInput");$("#confirmCheck1_error").css("display","none");if(isInlineValidationEnabled()){setAriaInvalidAttribute(this,false);}}break;case"confirmCheck2":if($("#confirmCheck2").hasClass("formInputForError")){$("#confirmCheck2MessagePanel").css("display","none");$("#confirmCheck2").removeClass("formInputForError").addClass("formInput");$("#confirmCheck2_error").css("display","none");if(isInlineValidationEnabled()){setAriaInvalidAttribute(this,false);}}break;}if($("#errorMessageDiv").children().length===1){$("#messagePanel").remove();}enablePayNowSubmitButton();}function addVisitedClass(a){if(!$(this).hasClass("visited")){$(this).addClass("visited");}}function textInputValidation(l){var b=l.keyCode?l.keyCode:l.charCode;var q=this.value;var k=$(this).parents("div.formSection");var i=!$("#expiryMonth").hasClass("visited")||!$("#expiryYear").hasClass("visited");var n=!$("#startMonth").hasClass("visited")||!$("#startYear").hasClass("visited");var c=false;var a,g,j,r=false;if(l.type.toLowerCase()==="blur"){q=q.trim();this.value=q;}var o=k.prop("id")==="issueSection"&&!defaultIssueFieldRequired&&!issueFieldRequired;if(b!==TAB_KEY_CODE){if(this.value===""){if(k.prop("id")==="expirySection"){if(!i&&($(this).prop("id")==="expiryMonth"||$(this).prop("id")==="expiryYear")){setFieldInvalid(this);}if($(this).prop("id")==="expiryYearText"||$(this).prop("id")==="expiryMonthText"){if(k.hasClass("required")){setFieldInvalid(this);}}}else{if(k.prop("id")==="startSection"){if(!n&&($(this).prop("id")==="startMonth"||$(this).prop("id")==="startYear")){setFieldInvalid(this);}if($(this).prop("id")==="startYearText"||$(this).prop("id")==="startMonthText"){if(k.hasClass("required")){setFieldInvalid(this);}}}else{if(k.prop("id")==="cscSection"||k.prop("id")==="confirmCscSection"){if(k.hasClass("required")){setFieldInvalid(this);}}else{if(isDisplayInlineValidationError&&o&&isInlineValidationEnabled()){clearFieldValidation(this);if($(this).prop("id")==="issue"){var f="#"+$(this).prop("id")+"Error";$(f).removeClass("inlineError").addClass("inlineValid");}}else{setFieldInvalid(this);}}}}if(o&&isInlineValidationEnabled()){setAriaInvalidAttribute(this,false);}if($(this).prop("id")==="cardType"&&currentCardType!==DEFAULT_CARD_TYPE&&currentCardType!==""){currentCardType=DEFAULT_CARD_TYPE;applyCardType();$("#infoMessagePanel").fadeOut("slow");$("#purchaseDetailsSurchargeAmount").fadeOut("slow");$("#purchaseDetailsTotalAmount").fadeOut("slow");}}else{var m=null;switch($(this).prop("id")){case"cardType":if($("#cardType").hasClass("formInputForError")){if($("#cardType_list").length){$("#cardType_list").remove();}if($("#cardTypeMessagePanel").length){$("#cardTypeMessagePanel").css("display","none");}$("#cardType").removeClass("formInputForError").addClass("formInput");}m=validationRegex.notEmptyOrAllWhitespace;if(currentCardType!=this.value){currentCardType=this.value;applyCardType();}break;case"expiryMonth":if($("#expiryMonth").hasClass("formInputForError")){$("#expiryDateMessagePanel").css("display","none");$("#expiryMonth").removeClass("formInputForError").addClass("formInput");$("#expiryMonth_list").remove();}m=validationRegex.notEmptyOrAllWhitespace;c=(!m.test(this.value)||($("#expiryYear").hasClass("visited")&&!m.test($("#expiryYear").val())));break;case"expiryYear":if($("#expiryYear").hasClass("formInputForError")){$("#expiryDateMessagePanel").css("display","none");$("#expiryYear").removeClass("formInputForError").addClass("formInput");$("#expiryMonth_list").remove();}m=validationRegex.notEmptyOrAllWhitespace;c=(!m.test(this.value)||($("#expiryMonth").hasClass("visited")&&!m.test($("#expiryMonth").val())));break;case"expiryMonthText":i=false;if(b==undefined&&this.value.length<2){this.value=getFormattedMonth(this.value);}a=validateExpiryMonthText(this.value);g=validateExpiryYearText($("#expiryYearText").val());if(a===false||g===false){c=true;}break;case"expiryYearText":i=false;g=validateExpiryYearText(this.value);a=validateExpiryMonthText($("#expiryMonthText").val());if(g==false||a==false){c=true;}break;case"startMonth":if($("#startMonth").hasClass("formInputForError")){$("#startDateMessagePanel").css("display","none");$("#startMonth").removeClass("formInputForError").addClass("formInput");$("#startMonth_list").remove();}m=validationRegex.notEmptyOrAllWhitespace;c=(!m.test(this.value)||($("#startYear").hasClass("visited")&&!m.test($("#startYear").val())));break;case"startYear":if($("#startYear").hasClass("formInputForError")){$("#startDateMessagePanel").css("display","none");$("#startYear").removeClass("formInputForError").addClass("formInput");$("#startMonth_list").remove();}m=validationRegex.notEmptyOrAllWhitespace;c=(!m.test(this.value)||($("#startMonth").hasClass("visited")&&!m.test($("#startMonth").val())));break;case"startMonthText":n=false;if(b==undefined&&this.value.length<2){this.value=getFormattedMonth(this.value);}j=validateStartMonthText(this.value);r=validateStartYearText($("#startYearText").val());if(j===false||r===false){c=true;}break;case"startYearText":n=false;r=validateStartYearText(this.value);j=validateStartMonthText($("#startMonthText").val());if(j===false||r===false){c=true;}break;case"cardholderName":if($("#cardholderName").hasClass("formInputForError")){$("#cardholderNameMessagePanel").css("display","none");$("#infoMessage span").addClass("highlight");$("#cardholderName").removeClass("formInputForError").addClass("formInput");$("#cardholderName_list").remove();}if($("#cardholderNameSection").hasClass("required")){m=validationRegex.cardholderName;}break;case"confirmCardholderName":if($("#confirmCardholderNameSection").hasClass("required")){m=validationRegex.cardholderName;
}break;case"cardNumber":if(!isTokenEditPanelUsed){if($("#cardNumber").hasClass("formInputForError")){$("#cardholderNumberMessagePanel").css("display","none");$("#cardNumber").removeClass("formInputForError").addClass("formInput");$("#cardNumber_list").remove();if($("#cardType_list").length&&isCardTypeDetectionConfigured){$("#cardType_list").remove();}if($("#cardTypeMessagePanel").length&&isCardTypeDetectionConfigured){$("#cardTypeMessagePanel").css("display","none");}}q=this.value.replace(/\s+/g,"");if(luhnChk(q)){m=validationRegex.cardNumber;}else{c=true;}}break;case"issue":if($("#issue").hasClass("formInputForError")){$("#issueMessagePanel").css("display","none");$("#issue").removeClass("formInputForError").addClass("formInput");$("#issue_list").remove();}m=validationRegex.issue;break;case"csc":if($("#csc").hasClass("formInputForError")){$("#cscMessagePanel").css("display","none");$("#csc").removeClass("formInputForError").addClass("formInput");$("#csc_list").remove();}var d=commonFindCardType($("#cardNumber").val());if(typeof(d)!=="undefined"&&d.type==="amex"){m=validationRegex.amexCsc;}else{m=validationRegex.csc;}break;case"confirmCsc":var h=$("#confirmCardLabel").text();var p=$("#confirmCardTypeLabel").text();if(typeof(p)!=="undefined"&&p.indexOf("amex")>=0){m=validationRegex.amexCsc;}else{m=validationRegex.csc;}break;}if($("#errorMessageDiv").children().length===1){$("#messagePanel").remove();}if(isInlineValidationEnabled()||m!=null){if(m!=null&&k.prop("id")!="expirySection"&&k.prop("id")!="startSection"){c=!m.exec(q);}if((k.prop("id")=="expirySection"&&!i)||(k.prop("id")=="startSection"&&!n)||(k.prop("id")!="expirySection"&&k.prop("id")!="startSection")){if(!c){setFieldValid($(this));}else{setFieldInvalid($(this));}}}else{clearFieldValidation($(this));}}enablePayNowSubmitButton();}}function validateExpiryMonthText(a){if($("#expiryMonthText").hasClass("formInputForError")){$("#expiryDateMessagePanel").css("display","none");$("#expiryMonthText").removeClass("formInputForError").addClass("formInput");$("#expiryMonthText_list").remove();}return isMonthValid(a,"EXPIRY");}function validateStartMonthText(a){if($("#startMonthText").hasClass("formInputForError")){$("#startDateMessagePanel").css("display","none");$("#startMonthText").removeClass("formInputForError").addClass("formInput");$("#startMonthText_list").remove();}return isMonthValid(a,"START");}function validateExpiryYearText(a){if($("#expiryYearText").hasClass("formInputForError")){$("#expiryDateMessagePanel").css("display","none");$("#expiryYearText").removeClass("formInputForError").addClass("formInput");$("#expiryMonthText_list").remove();}return isYearInRange(a,"EXPIRY");}function validateStartYearText(a){if($("#startYearText").hasClass("formInputForError")){$("#startDateMessagePanel").css("display","none");$("#startYearText").removeClass("formInputForError").addClass("formInput");$("#startMonthText_list").remove();}return isYearInRange(a,"START");}function getFormattedMonth(a){return a<10&&a.length<2?"0"+a:a;}function isYearInRange(b,h){var d;var c;var a,e,i,f;var g=false;if(h=="START"){a="startYearFormat";f="startYearRange";e=startYearFormat;i=startYearRange;}else{if(h=="EXPIRY"){a="expiryYearFormat";f="expiryYearRange";e=expiryYearFormat;i=expiryYearRange;}}if(cardOptionsConfigured&&cardOptionsJSON[currentCardType]){e=cardOptionsJSON[currentCardType][a];i=cardOptionsJSON[currentCardType][f];}else{if(cardOptionsConfigured){e=cardOptionsJSON[DEFAULT_CARD_TYPE][a];i=cardOptionsJSON[DEFAULT_CARD_TYPE][f];}}if(b.length!=e.length){return false;}if(e.length==4){c=new Date().getFullYear();d=validationRegex.fullYear;}else{c=Number(new Date().getFullYear().toString().substr(-2));d=validationRegex.shortYear;}if(h=="EXPIRY"){g=b<=(c+i)&&b>=c&&d.exec(b)!==null;}else{if(h=="START"){g=b<=c&&d.exec(b)!==null;}}return g;}function isMonthValid(b,c){var e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];var a=["01","02","03","04","05","06","07","08","09","10","11","12"];var f,d;if(c=="START"){f="startMonthFormat";d=startMonthFormat;}else{if(c=="EXPIRY"){f="expiryMonthFormat";d=expiryMonthFormat;}}if(cardOptionsConfigured&&cardOptionsJSON[currentCardType]){d=cardOptionsJSON[currentCardType][f];}else{if(cardOptionsConfigured&&cardOptionsJSON===undefined){d=cardOptionsJSON[DEFAULT_CARD_TYPE][f];}}if(d=="mm"){b=getFormattedMonth(b);return a.indexOf(b)>=0;}else{if(d=="MMM"){b=b.toLowerCase();return e.indexOf(b)>=0;}else{return false;}}}function setFieldInvalid(a){$(a).parents("div.formSection").removeClass("inputValid").addClass("inputError");if(isInlineValidationEnabled()){setAriaInvalidAttribute(a,true);}if(isDisplayInlineValidationError&&isInlineValidationEnabled()){if($(a).parents("div.formSection").prop("id")==="expirySection"||$(a).parents("div.formSection").prop("id")==="startSection"){var b="#"+$(a).parents("div.formSection").prop("id").replace("Section","")+"DateError";}else{var b="#"+$(a).prop("id")+"Error";}$(b).removeClass("inlineValid").addClass("inlineError");updateAriaDescribedByForInvalidInlineValidation(a);}}function setFieldValid(a){$(a).parents("div.formSection").removeClass("inputError").addClass("inputValid");if(isInlineValidationEnabled()){setAriaInvalidAttribute(a,false);}if(isDisplayInlineValidationError&&isInlineValidationEnabled()){if($(a).parents("div.formSection").prop("id")==="expirySection"||$(a).parents("div.formSection").prop("id")==="startSection"){var b="#"+$(a).parents("div.formSection").prop("id").replace("Section","")+"DateError";}else{var b="#"+$(a).prop("id")+"Error";}$(b).removeClass("inlineError").addClass("inlineValid");updateAriaDescribedByForValidInlineValidation(a);}}function clearFieldValidation(a){$(a).parents("div.formSection").removeClass("inputError").removeClass("inputValid");}var luhnChk=(function(a){return function(f){var b=0,e=1,c=0,d;f=f.replace(/\s+/g,"");b=f.length;while(b){d=parseInt(f.charAt(--b),10);if(isNaN(d)){return false;}c+=(e^=1)?a[d]:d;}return c&&c%10===0;};}([0,2,4,6,8,1,3,5,7,9]));function paymentMethodsValidation(){if(isInlineValidationEnabled()){$("input[name='paymentMethod']").each(function(){$(this).click(paymentMethodValidation);});}}function inlineValidation(){if($("#semafone").length==0){if(isInlineValidationEnabled()){$("div.formSection[class*='required'] input[type='text'].formInput, div.formSection[class*='required'] input[type='tel'].formInput").each(function(){$(this).on("blur.validation keyup",textInputValidation);});$("div.formSection[class*='required'] input[type='text'].formInputForError, div.formSection[class*='required'] input[type='tel'].formInputForError").each(function(){$(this).on("blur.validation keyup",textInputValidation);});$("div.formSection[class*='required'] select.formInput").each(function(){$(this).focus(addVisitedClass);$(this).on("blur.validation change",textInputValidation);});$("div.formSection[class*='required'] select.formInputForError").each(function(){$(this).focus(addVisitedClass);$(this).on("blur.validation change",textInputValidation);});$("div.formSection[class*='required'] input[type='checkbox'].formInput").each(function(){$(this).on("blur.validation click",checkboxValidation);});$("div.formSection[class*='required'] input[type='checkbox'].formInputForError").each(function(){$(this).on("blur.validation click",checkboxValidation);});$("div.formSection[class*='validate'] input[type='text'].formInput, div.formSection[class*='validate'] input[type='tel'].formInput").each(function(){$(this).on("blur.validation keyup",textInputValidation);});$("div.formSection[class*='validate'] input[type='text'].formInputForError, div.formSection[class*='validate'] input[type='tel'].formInputForError").each(function(){$(this).on("blur.validation keyup",textInputValidation);});}else{$("div.formSection[class*='required'] input[id='confirmCardholderName'].formInput, div.formSection[class*='required'] input[id='cardholderName'].formInput").each(function(){$(this).on("blur.validation keyup",textInputValidation);
});$("div.formSection[class*='required'] input[id='confirmCardholderName'].formInputForError, div.formSection[class*='required'] input[id='cardholderName'].formInputForError").each(function(){$(this).on("blur.validation keyup",textInputValidation);});$("div.formSection[class*='required'] select.formInput input[id='confirmCardholderName'],div.formSection[class*='required'] select.formInput input[id='cardholderName']").each(function(){$(this).focus(addVisitedClass);$(this).on("blur.validation change",textInputValidation);});$("div.formSection[class*='required'] select.formInputForError input[id='confirmCardholderName'],div.formSection[class*='required'] select.formInputForError input[id='cardholderName']").each(function(){$(this).focus(addVisitedClass);$(this).on("blur.validation change",textInputValidation);});}}}function updateAriaDescribedByForInvalidInlineValidation(b){var c=$(b).prop("id");var a=c+"Error";if(["expiryMonth","expiryYear","expiryMonthText","expiryYearText"].indexOf(c)>=0){a="expiryDateError";}else{if(["startMonth","startYear","startMonthText","startYearText"].indexOf(c)>=0){a="startDateError";}}if(a!==""){$("#"+c).attr("aria-describedby",a);}}function updateAriaDescribedByForValidInlineValidation(a){$("#"+$(a).prop("id")).attr("aria-describedby","");}$(function(){inlineValidation();paymentMethodsValidation();enablePayNowSubmitButton();});