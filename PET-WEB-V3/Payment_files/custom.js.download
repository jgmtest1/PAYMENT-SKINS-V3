var isUnauthorised=false;var continueBtnClicked=false;var hasAnyValidationError=false;var deviceCategory;var deviceModel;var deviceOs;var deviceBrowser;
$(document).ready(function(){$.ajaxSetup({beforeSend:function(xhr,s){if($("meta[name\x3d'csrfTokenName']")&&$("meta[name\x3d'csrfTokenName']").attr("content")&&$("meta[name\x3d'csrfTokenValue']")&&$("meta[name\x3d'csrfTokenValue']").attr("content"))xhr.setRequestHeader($("meta[name\x3d'csrfTokenName']").attr("content"),$("meta[name\x3d'csrfTokenValue']").attr("content"));xhr.setRequestHeader("maintreeversion",typeof mainTreeVersion!="undefined"&&mainTreeVersion!=null?mainTreeVersion:0);if(s.data!=
undefined&&s.data!=null)s.data=s.data.replace("partName\x3d","partName\x3dpart__")},dataFilter:function(response){let resObj=JSON.parse(response);if(resObj.isUnauthorized){isUnauthorised=true;selectedflow=resObj.selectedflow;goToUnauthorizedPage(selectedflow)}return response}});var date=new Date;setCookieForMinutes("timeChecker",date.toUTCString(),29);manageTourProperty();if(typeof next!="undefined")if(getCookie("passed")!=null&&getCookie("passed")!=partName&&getCookie("qnb")!="set"&&window.location.href.indexOf("personReference")>
-1){setCookie("passed",partName);$("#loaderModalLoader").click();window.location.href=window.location.href+"\x26back\x3d2"}else if(getCookie("qnb")=="set"){setCookie("qnb",null);setCookie("passed",partName)}else setCookie("passed",partName);$(function(){$('[data-toggle\x3d"tooltip"]').tooltip()});$(".date-picker").each(function(){$(this).datepicker()});$(".modal").on("shown.bs.modal",function(){$(".modal").animate({scrollTop:0},"slow")});$("#errorClose").on("click",function(){$("#loaderModalLoader").click()});
$(".date-pick").change(function(){$("#datepicker").hide();if($(this).attr("id")=="otherDate")$("#datepicker").show()});if(partName!="pet-v2-price-and-cover-levels")$("#go-to-question-btn").on("click",function(e){goToFirstIncompleteQuestion()});setTimeout(function(){setupModals()},10);$(function(){function timeChecker(){setInterval(function(){timeCompare()},1E3)}function timeCompare(){if(getCookie("r1")!=null){var createdTime=getCookie("timeChecker");if(createdTime==null){eraseCookie("r1");eraseCookie("r2");
eraseCookie("r3");eraseCookie("passed");window.location=window.location.pathname;return false}var currentTime=(new Date).toUTCString();var timeDiff=new Date(currentTime)-new Date(createdTime);var minPast=timeDiff/6E4;if(minPast==20){$("#timeOutModal").modal("show");return false}else;}}timeChecker()})});
function continueQuote(){goToStep(getCookie("passed"),{personReference,quoteReference,propertyReference:pets!=null?pets[pets.length-1].propertyReference:mainTreeResponse.result.quote.properties[mainTreeResponse.result.quote.properties.length-1].propertyReference},{})}
$(document).ready(function(){$(".collapse.show").each(function(){$(this).prev(".card-header").find(".fas").addClass("fa-angle-up").removeClass("fa-angle-down")});$(".collapse").on("show.bs.collapse",function(e){$(this).prev(".card-header").find(".fas").removeClass("fa-angle-down").addClass("fa-angle-up");let name=e.target.getAttribute("name");if(name)gtmAccordion(name,"pet-summary")}).on("hide.bs.collapse",function(){$(this).prev(".card-header").find(".fas").removeClass("fa-angle-up").addClass("fa-angle-down")});
$("#loadNewQuoteButton").on("click",function(){loadNewQuote()})});function LOG(msg,object){typeof isDev!=="undefined"&&isDev?object?console.log(msg,object):console.log(msg):null}
function loadNewQuote(){deleteSecureCookies();let petName=(new URLSearchParams(window.location.search)).get("pet_name");let paramList={selectedflow:"optimizely2"};if(petName!=null)paramList["pet_name"]=petName;if(partName=="pet-details"||partName=="pet-name")setCookie("passed",partName);if(selectedflow=="msm"){eraseCookie("selectedflow");eraseCookie("r1");eraseCookie("r2");eraseCookie("r3");setCookie("selectedflow","optimizely2");goToStep("about-your-pet",paramList,{})}else if(selectedflow=="optimizely2"){eraseCookie("selectedflow");
eraseCookie("r1");eraseCookie("r2");eraseCookie("r3");setCookie("selectedflow","optimizely2");goToStep("about-your-pet",paramList,{})}else if(selectedflow=="idol"||selectedflow=="goco"){eraseCookie("selectedflow");eraseCookie("r1");eraseCookie("r2");eraseCookie("r3");setCookie("selectedflow","optimizely2");goToStep("about-your-pet",paramList,{})}else if(selectedflow=="quotezone"){eraseCookie("selectedflow");eraseCookie("r1");eraseCookie("r2");eraseCookie("r3");setCookie("selectedflow","optimizely2");
goToStep("about-your-pet",paramList,{})}}
function setupModals(){if(typeof pet!="undefined"&&pet){$(".modal-title").each(function(index,element){element.innerHTML=element.innerHTML.replace(/@petFirstname@/gm,'\x3cspan class\x3d"text-secondary fw-bolder text-break text-pet-name"\x3e'+pet.attributes.firstName+"\x3c/span\x3e")});$(".modal-body").each(function(index,element){element.innerHTML=element.innerHTML.replace(/@petFirstname@/gm,'\x3cspan class\x3d"text-secondary fw-bold text-break text-pet-name"\x3e'+pet.attributes.firstName+"\x3c/span\x3e").replace(/@speciesold@/gm,
'\x3cspan class\x3d"text-primary"\x3e'+pet.attributes.species+"\x3c/span\x3e").replace(/@speciesnew@/gm,'\x3cspan class\x3d"text-primary text-pet-species"\x3e'+(pet.attributes.species=="CAT"?"DOG":"CAT")+"\x3c/span\x3e")})}}let errorsArr=[];window.onerror=function(error,url,line){errorsArr.push({acc:"error",data:"ERR:"+error+" URL:"+url+" L:"+line});$.ajax({type:"POST",url:componentURL1,data:{errorData:JSON.stringify({acc:"error",data:"ERR:"+error+" URL:"+url+" L:"+line,path:window.location.href})}})};
function elementInViewport1(el){var top=el.offsetTop;var left=el.offsetLeft;var width=el.offsetWidth;var height=el.offsetHeight;while(el.offsetParent){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft}return top>=window.pageYOffset&&left>=window.pageXOffset&&top+height<=window.pageYOffset+window.innerHeight&&left+width<=window.pageXOffset+window.innerWidth}if($("#titleLbl").length)document.getElementById("titleLbl").focus();var elementInFocusToClick="unselected";
function clickElementFunction(element){elementInFocusToClick=element}function focusedOnListItem(element){elementInFocusToClick=element.innerHTML.replace(/ /g,"")}function unselect(){elementInFocusToClick="unselected"}
(function(){var input=document;input.addEventListener("keyup",function(event){if(event.keyCode===13){console.log(elementInFocusToClick);event.preventDefault();if(elementInFocusToClick.includes("#")||elementInFocusToClick.includes("."))$(elementInFocusToClick).trigger("click");else if(elementInFocusToClick.includes("*")){elementInFocusToClick=elementInFocusToClick.replace("*","#");$(elementInFocusToClick)[0].click()}else $("li").filter(function(){return $(this).text().replace(/ /g,"")===elementInFocusToClick}).trigger("click")}})})();
function elementInViewport2(el){if(typeof jQuery==="function"&&el instanceof jQuery)el=el[0];var rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function elementInViewport(el){return el.getBoundingClientRect().y<=(window.innerHeight||document.documentElement.clientHeight)}
function manageTourProperty(){if(!localStorage.tourProperties)localStorage.tourProperties=JSON.stringify([]);let tourProperties=JSON.parse(localStorage.tourProperties);if(typeof propertyReference!="undefined"&&propertyReference){if(tourProperties.length==0)tourProperties.push(propertyReference);else if(tourProperties[tourProperties.length-1]!=propertyReference)tourProperties.push(propertyReference);localStorage.tourProperties=JSON.stringify(tourProperties)}}
function zECall(a,b,c){if(typeof zE=="function")zE(a,b,c)}function setIncrementalInterval(fn,initTime,incr){setTimeout(fn,initTime);setTimeout(function(){setIncrementalInterval(fn,initTime+incr,incr)},initTime)}function goToUnauthorizedPage(selectedflow){eraseCookie("selectedflow");eraseCookie("r1");eraseCookie("r2");eraseCookie("r3");setCookie("selectedflow",selectedflow);goToStep("unauthorised",{selectedflow:selectedflow},{},false)}$(window).resize(function(){repositionCookieBanner()});
function repositionCookieBanner(){var cookieHeight=0;if(!$("#alert-cookie").is(":visible")){cookieHeight=0;$(".site-container").css("padding-bottom",cookieHeight+"px")}else{if($(this).width()<768)cookieHeight=$("#alert-cookie").height()+30;else cookieHeight=$("#alert-cookie").height()+64;$(".site-container").css("padding-bottom",cookieHeight+"px")}}$(window).trigger("resize");
function goToFirstIncompleteQuestion(){if(hasAnyValidationError){let i=0;while(document.getElementsByClassName("alert-danger")[i].offsetParent==null)i++;document.getElementsByClassName("alert-danger")[i].closest("fieldset").scrollIntoView()}else{let i=0;while(document.getElementsByClassName("fld-to-validate")[i].offsetParent==null)i++;document.getElementsByClassName("fld-to-validate")[i].scrollIntoView()}}
function getRequiredErrorMessage(inputField,message="Please answer this question"){if(continueBtnClicked){$(inputField.closest(".go-to-question")).addClass("fld-to-validate");return"Please answer this question"}return message}
function updateGoToQuestionSection(formElement,isFormValid=false){if(continueBtnClicked){if(partName=="about-your-pet")handleBreedRules();let isValid=formElement.valid();let errorCount=0;let successList=formElement.validate().successList;for(const successListElement of successList)$(successListElement.closest(".go-to-question")).removeClass("fld-to-validate");formElement.valid();if(!isValid){$(".fld-to-validate").each(function(){if($(this).is(":visible"))errorCount++});if(errorCount!=0){$("#goToQuestionBtnContainer p").text("This section has "+
errorCount+" incomplete question"+(errorCount>1?"s.":"."));$("#goToQuestionBtnContainer").show()}}if(errorCount==0)if(partName=="about-your-pet"&&!isFormValid){let validationErrorMsgCount=0;let validationErrorElement;$(".alert-danger").each(function(){if($(this).is(":visible")){validationErrorMsgCount++;validationErrorElement=$(this)}});if(validationErrorMsgCount==1){$("#goToQuestionBtnContainer p").text("This section has 1 incomplete question.");$("#goToQuestionBtnContainer").show();validationErrorElement.closest(".go-to-question").addClass("fld-to-validate");
hasAnyValidationError=true}}else $("#goToQuestionBtnContainer").hide()}}
function getDeviceDetails(){var module={options:[],header:[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera],dataos:[{name:"Windows Phone",value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",
value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}],databrowser:[{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",
version:"Mozilla"}],init:function(){var agent=this.header.join(" ");os=this.matchItem(agent,this.dataos);browser=this.matchItem(agent,this.databrowser);return{os:os,browser:browser}},matchItem:function(string,data){var i=0,j=0,html="",regex,regexv,match,matches,version;for(i=0;i<data.length;i+=1){regex=new RegExp(data[i].value,"i");match=regex.test(string);if(match){regexv=new RegExp(data[i].version+"[- /:;]([\\d._]+)","i");matches=string.match(regexv);version="";if(matches)if(matches[1])matches=
matches[1];if(matches){matches=matches.split(/[._]+/);for(j=0;j<matches.length;j+=1)if(j===0)version+=matches[j]+".";else version+=matches[j]}else version="0";return{name:data[i].name,version:parseFloat(version)}}}return{name:"unknown",version:0}}};var e=module.init();const userAgent=navigator.userAgent;deviceOs=e.os.name+" "+e.os.version;if(/Edg/.test(navigator.userAgent))deviceBrowser="Edge";else if(navigator.userAgent.indexOf("OPR")>-1)deviceBrowser="Opera";else if(navigator.userAgent.indexOf("SamsungBrowser")>
-1){deviceBrowser="Samsung Internet";deviceOs="Android"+" "+e.os.version}else if(deviceOs.indexOf("iPhone")>-1&&navigator.userAgent.indexOf("CriOS")>-1)deviceBrowser="Chrome";else if(deviceOs.indexOf("iPhone")>-1&&navigator.userAgent.indexOf("FxiOS")>-1)deviceBrowser="Firefox";else if(deviceOs.indexOf("iPad")>-1&&navigator.userAgent.indexOf("CriOS")>-1)deviceBrowser="Chrome";else if(deviceOs.indexOf("iPad")>-1&&navigator.userAgent.indexOf("FxiOS")>-1)deviceBrowser="Firefox";else deviceBrowser=e.browser.name;
if($(window).width()<768)deviceCategory="Mobile";else if($(window).width()>=768&&$(window).width()<992)deviceCategory="Tablet";else deviceCategory="Desktop";var str=navigator.userAgent.substring(userAgent.indexOf("(")+1,userAgent.indexOf(")"));if(e.os.name=="Android")deviceModel=str.split(";").length>=3?str.split(";")[2].trim():str.split(";")[0].trim();else if(e.os.name=="iPhone")deviceModel=str.split(";")[0].trim();else if(e.os.name=="Macintosh"&&deviceCategory=="Tablet")deviceModel=str.split(";").length>=
2?str.split(";")[1].trim():str.split(";")[0].trim();else if(e.os.name=="Macintosh"&&deviceCategory=="Desktop")deviceModel=str.split(";").length>=2?str.split(";")[1].trim():str.split(";")[0].trim();else if(e.os.name=="Windows")deviceModel=str.split(";").length>=2?str.split(";")[1].trim():str.split(";")[0].trim();else if(e.os.name=="Linux")deviceModel=str.split(";").length>=3?str.split(";")[2].trim():str.split(";")[0].trim();else deviceModel=str.split(";").length>=2?str.split(";")[1].trim():str.split(";")[0].trim()}
;